devtools::load_all()
# create the metadata for a new survey
a_survey_metadata <-  mdl_survey_generate_metadata_list(
survey_idno = "UNHCR_ETH_2021_TEST_v2.1",
title = "A Test Survey, 2025",
country_ISO_alpha3_codes = c("ETH"),
#enum_survey_study_type = mdl_enum_survey_study_type$`Sample Frame, Households [sf/hh]`,
#series_information = "A series test...",
abstract = "This is a test survey create using APIs...",
#enum_survey_kind_of_data = mdl_enum_survey_kind_of_data$`Sample survey data [ssd]`,
#unit_of_analysis = "Household",
#version_description = "v2.1: Edited, cleaned and anonymised data.",
#version_date = "2025-07-04",
#scope_description = "The scope includes: \n- household characteristics \n- dwellings",
#enum_survey_topics = c(mdl_enum_survey_topics$Health, mdl_enum_survey_topics$Protection),
#keywords = c("Keyword 1", "Keyword 2", "Keyword 3"),
#geographic_coverage = "Whole country.",
#universe = "All people of concern.",
primary_investigators = c("UNHCR"),
#other_producers = c("Another organisation"),
#sampling_description = "Simple sampling was applied...",
#weighting_description = "Weight was calculated in the following manner...",
collection_date_start = "2024-12-12",
collection_date_end = "2025-01-01",
#enum_survey_collection_mode = NULL,#c(mdl_enum_survey_collection_mode$`Face-to-face [f2f]`, mdl_enum_survey_collection_mode$`Mail Questionnaire [mail]`),
#data_collection_notes = "Enumerators took a 3-day course...",
#data_collectors = c("Collector 1", "Collector2"),
#questionnaire_description = "Questionaire contained the following sections: ... ",
contacts_list = NA, #list(list(name = "Curation team", affiliation = "UNHCR", email = "xxx@xxx.org"),
#  list(name = "Another team", affiliation = "UNHCR", email = "xxx2@xxx.org")),
publication_year = 2025,
citation_requirements = NULL
)
# create the survey passing the metadata list
a_response <- mdl_survey_create(
survey_metadata_list = a_survey_metadata,
enum_collection = mdl_enum_collection$EastAfrica,
enum_survey_access_policy = mdl_enum_survey_access_policy$`Licensed use files`,
published = FALSE,
overwrite = TRUE
)
# create the metadata for a new survey
a_survey_metadata <-  mdl_survey_generate_metadata_list(
survey_idno = "UNHCR_ETH_2021_TEST_v2.1",
title = "A Test Survey, 2025",
country_ISO_alpha3_codes = c("ETH"),
#enum_survey_study_type = mdl_enum_survey_study_type$`Sample Frame, Households [sf/hh]`,
#series_information = "A series test...",
abstract = "This is a test survey create using APIs...",
#enum_survey_kind_of_data = mdl_enum_survey_kind_of_data$`Sample survey data [ssd]`,
#unit_of_analysis = "Household",
#version_description = "v2.1: Edited, cleaned and anonymised data.",
#version_date = "2025-07-04",
#scope_description = "The scope includes: \n- household characteristics \n- dwellings",
#enum_survey_topics = c(mdl_enum_survey_topics$Health, mdl_enum_survey_topics$Protection),
#keywords = c("Keyword 1", "Keyword 2", "Keyword 3"),
#geographic_coverage = "Whole country.",
#universe = "All people of concern.",
primary_investigators = c("UNHCR"),
#other_producers = c("Another organisation"),
#sampling_description = "Simple sampling was applied...",
#weighting_description = "Weight was calculated in the following manner...",
collection_date_start = "2024-12-12",
collection_date_end = "2025-01-01",
#enum_survey_collection_mode = NULL,#c(mdl_enum_survey_collection_mode$`Face-to-face [f2f]`, mdl_enum_survey_collection_mode$`Mail Questionnaire [mail]`),
#data_collection_notes = "Enumerators took a 3-day course...",
#data_collectors = c("Collector 1", "Collector2"),
#questionnaire_description = "Questionaire contained the following sections: ... ",
contacts_list = NA, #list(list(name = "Curation team", affiliation = "UNHCR", email = "xxx@xxx.org"),
#  list(name = "Another team", affiliation = "UNHCR", email = "xxx2@xxx.org")),
publication_year = 2027,
citation_requirements = NULL
)
# create the survey passing the metadata list
a_response <- mdl_survey_create(
survey_metadata_list = a_survey_metadata,
enum_collection = mdl_enum_collection$EastAfrica,
enum_survey_access_policy = mdl_enum_survey_access_policy$`Licensed use files`,
published = FALSE,
overwrite = TRUE
)
# create the metadata for a new survey
a_survey_metadata <-  mdl_survey_generate_metadata_list(
survey_idno = "UNHCR_ETH_2021_TEST_v2.1",
title = "A Test Survey, 2025",
country_ISO_alpha3_codes = c("ETH"),
#enum_survey_study_type = mdl_enum_survey_study_type$`Sample Frame, Households [sf/hh]`,
#series_information = "A series test...",
abstract = "This is a test survey create using APIs...",
#enum_survey_kind_of_data = mdl_enum_survey_kind_of_data$`Sample survey data [ssd]`,
#unit_of_analysis = "Household",
#version_description = "v2.1: Edited, cleaned and anonymised data.",
#version_date = "2025-07-04",
#scope_description = "The scope includes: \n- household characteristics \n- dwellings",
#enum_survey_topics = c(mdl_enum_survey_topics$Health, mdl_enum_survey_topics$Protection),
#keywords = c("Keyword 1", "Keyword 2", "Keyword 3"),
#geographic_coverage = "Whole country.",
#universe = "All people of concern.",
primary_investigators = c("UNHCR"),
#other_producers = c("Another organisation"),
#sampling_description = "Simple sampling was applied...",
#weighting_description = "Weight was calculated in the following manner...",
collection_date_start = "2024-12-12",
collection_date_end = "2025-01-01",
#enum_survey_collection_mode = NULL,#c(mdl_enum_survey_collection_mode$`Face-to-face [f2f]`, mdl_enum_survey_collection_mode$`Mail Questionnaire [mail]`),
#data_collection_notes = "Enumerators took a 3-day course...",
#data_collectors = c("Collector 1", "Collector2"),
#questionnaire_description = "Questionaire contained the following sections: ... ",
contacts_list = NA, #list(list(name = "Curation team", affiliation = "UNHCR", email = "xxx@xxx.org"),
#  list(name = "Another team", affiliation = "UNHCR", email = "xxx2@xxx.org")),
publication_year = 2027,
citation_requirements = ""
)
# create the survey passing the metadata list
a_response <- mdl_survey_create(
survey_metadata_list = a_survey_metadata,
enum_collection = mdl_enum_collection$EastAfrica,
enum_survey_access_policy = mdl_enum_survey_access_policy$`Licensed use files`,
published = FALSE,
overwrite = TRUE
)
# create the metadata for a new survey
a_survey_metadata <-  mdl_survey_generate_metadata_list(
survey_idno = "UNHCR_ETH_2021_TEST_v2.1",
title = "A Test Survey, 2025",
country_ISO_alpha3_codes = c("ETH"),
#enum_survey_study_type = mdl_enum_survey_study_type$`Sample Frame, Households [sf/hh]`,
#series_information = "A series test...",
abstract = "This is a test survey create using APIs...",
#enum_survey_kind_of_data = mdl_enum_survey_kind_of_data$`Sample survey data [ssd]`,
#unit_of_analysis = "Household",
#version_description = "v2.1: Edited, cleaned and anonymised data.",
#version_date = "2025-07-04",
#scope_description = "The scope includes: \n- household characteristics \n- dwellings",
#enum_survey_topics = c(mdl_enum_survey_topics$Health, mdl_enum_survey_topics$Protection),
#keywords = c("Keyword 1", "Keyword 2", "Keyword 3"),
#geographic_coverage = "Whole country.",
#universe = "All people of concern.",
primary_investigators = c("UNHCR"),
#other_producers = c("Another organisation"),
#sampling_description = "Simple sampling was applied...",
#weighting_description = "Weight was calculated in the following manner...",
collection_date_start = "2024-12-12",
collection_date_end = "2025-01-01",
#enum_survey_collection_mode = NULL,#c(mdl_enum_survey_collection_mode$`Face-to-face [f2f]`, mdl_enum_survey_collection_mode$`Mail Questionnaire [mail]`),
#data_collection_notes = "Enumerators took a 3-day course...",
#data_collectors = c("Collector 1", "Collector2"),
#questionnaire_description = "Questionaire contained the following sections: ... ",
contacts_list = NA, #list(list(name = "Curation team", affiliation = "UNHCR", email = "xxx@xxx.org"),
#  list(name = "Another team", affiliation = "UNHCR", email = "xxx2@xxx.org")),
publication_year = 2027,
citation_requirements = "aaa"
)
# create the survey passing the metadata list
a_response <- mdl_survey_create(
survey_metadata_list = a_survey_metadata,
enum_collection = mdl_enum_collection$EastAfrica,
enum_survey_access_policy = mdl_enum_survey_access_policy$`Licensed use files`,
published = FALSE,
overwrite = TRUE
)
Sys.Date()
devtools::load_all()
# create the metadata for a new survey
a_survey_metadata <-  mdl_survey_generate_metadata_list(
survey_idno = "UNHCR_ETH_2021_TEST_v2.1",
title = "A Test Survey, 2025",
country_ISO_alpha3_codes = c("ETH"),
#enum_survey_study_type = mdl_enum_survey_study_type$`Sample Frame, Households [sf/hh]`,
#series_information = "A series test...",
abstract = "This is a test survey create using APIs...",
#enum_survey_kind_of_data = mdl_enum_survey_kind_of_data$`Sample survey data [ssd]`,
#unit_of_analysis = "Household",
#version_description = "v2.1: Edited, cleaned and anonymised data.",
#version_date = "2025-07-04",
#scope_description = "The scope includes: \n- household characteristics \n- dwellings",
#enum_survey_topics = c(mdl_enum_survey_topics$Health, mdl_enum_survey_topics$Protection),
#keywords = c("Keyword 1", "Keyword 2", "Keyword 3"),
#geographic_coverage = "Whole country.",
#universe = "All people of concern.",
primary_investigators = c("UNHCR"),
#other_producers = c("Another organisation"),
#sampling_description = "Simple sampling was applied...",
#weighting_description = "Weight was calculated in the following manner...",
collection_date_start = "2024-12-12",
collection_date_end = "2025-01-01",
#enum_survey_collection_mode = NULL,#c(mdl_enum_survey_collection_mode$`Face-to-face [f2f]`, mdl_enum_survey_collection_mode$`Mail Questionnaire [mail]`),
#data_collection_notes = "Enumerators took a 3-day course...",
#data_collectors = c("Collector 1", "Collector2"),
#questionnaire_description = "Questionaire contained the following sections: ... ",
contacts_list = NA, #list(list(name = "Curation team", affiliation = "UNHCR", email = "xxx@xxx.org"),
#  list(name = "Another team", affiliation = "UNHCR", email = "xxx2@xxx.org")),
publication_year = 2027,
citation_requirements = "aaa"
)
# create the survey passing the metadata list
a_response <- mdl_survey_create(
survey_metadata_list = a_survey_metadata,
enum_collection = mdl_enum_collection$EastAfrica,
enum_survey_access_policy = mdl_enum_survey_access_policy$`Licensed use files`,
published = FALSE,
overwrite = TRUE
)
# create the metadata for a new survey
a_survey_metadata <-  mdl_survey_generate_metadata_list(
survey_idno = "UNHCR_ETH_2021_TEST_v2.1",
title = "A Test Survey, 2025",
country_ISO_alpha3_codes = c("ETH"),
#enum_survey_study_type = mdl_enum_survey_study_type$`Sample Frame, Households [sf/hh]`,
#series_information = "A series test...",
abstract = "This is a test survey create using APIs...",
#enum_survey_kind_of_data = mdl_enum_survey_kind_of_data$`Sample survey data [ssd]`,
#unit_of_analysis = "Household",
#version_description = "v2.1: Edited, cleaned and anonymised data.",
#version_date = "2025-07-04",
#scope_description = "The scope includes: \n- household characteristics \n- dwellings",
#enum_survey_topics = c(mdl_enum_survey_topics$Health, mdl_enum_survey_topics$Protection),
#keywords = c("Keyword 1", "Keyword 2", "Keyword 3"),
#geographic_coverage = "Whole country.",
#universe = "All people of concern.",
primary_investigators = c("UNHCR"),
#other_producers = c("Another organisation"),
#sampling_description = "Simple sampling was applied...",
#weighting_description = "Weight was calculated in the following manner...",
collection_date_start = "2024-12-12",
collection_date_end = "2025-01-01",
#enum_survey_collection_mode = NULL,#c(mdl_enum_survey_collection_mode$`Face-to-face [f2f]`, mdl_enum_survey_collection_mode$`Mail Questionnaire [mail]`),
#data_collection_notes = "Enumerators took a 3-day course...",
#data_collectors = c("Collector 1", "Collector2"),
#questionnaire_description = "Questionaire contained the following sections: ... ",
contacts_list = NA, #list(list(name = "Curation team", affiliation = "UNHCR", email = "xxx@xxx.org"),
#  list(name = "Another team", affiliation = "UNHCR", email = "xxx2@xxx.org")),
publication_year = 2027,
citation_requirements = "aaa",
metadata_producer = "HDX",
metadata_production_date = "2030-01-07"
)
# create the survey passing the metadata list
a_response <- mdl_survey_create(
survey_metadata_list = a_survey_metadata,
enum_collection = mdl_enum_collection$EastAfrica,
enum_survey_access_policy = mdl_enum_survey_access_policy$`Licensed use files`,
published = FALSE,
overwrite = TRUE
)
# create the metadata for a new survey
a_survey_metadata <-  mdl_survey_generate_metadata_list(
survey_idno = "UNHCR_ETH_2021_TEST_v2.1",
title = "A Test Survey, 2025",
country_ISO_alpha3_codes = c("ETH"),
#enum_survey_study_type = mdl_enum_survey_study_type$`Sample Frame, Households [sf/hh]`,
#series_information = "A series test...",
abstract = "This is a test survey create using APIs...",
#enum_survey_kind_of_data = mdl_enum_survey_kind_of_data$`Sample survey data [ssd]`,
#unit_of_analysis = "Household",
#version_description = "v2.1: Edited, cleaned and anonymised data.",
#version_date = "2025-07-04",
#scope_description = "The scope includes: \n- household characteristics \n- dwellings",
#enum_survey_topics = c(mdl_enum_survey_topics$Health, mdl_enum_survey_topics$Protection),
#keywords = c("Keyword 1", "Keyword 2", "Keyword 3"),
#geographic_coverage = "Whole country.",
#universe = "All people of concern.",
primary_investigators = c("UNHCR"),
#other_producers = c("Another organisation"),
#sampling_description = "Simple sampling was applied...",
#weighting_description = "Weight was calculated in the following manner...",
collection_date_start = "2024-12-12",
collection_date_end = "2025-01-01",
#enum_survey_collection_mode = NULL,#c(mdl_enum_survey_collection_mode$`Face-to-face [f2f]`, mdl_enum_survey_collection_mode$`Mail Questionnaire [mail]`),
#data_collection_notes = "Enumerators took a 3-day course...",
#data_collectors = c("Collector 1", "Collector2"),
#questionnaire_description = "Questionaire contained the following sections: ... ",
contacts_list = NA, #list(list(name = "Curation team", affiliation = "UNHCR", email = "xxx@xxx.org"),
#  list(name = "Another team", affiliation = "UNHCR", email = "xxx2@xxx.org")),
publication_year = 2027,
citation_requirements = "aaa",
metadata_producer = "HDX"
# metadata_production_date = "2030-01-07"
)
# create the survey passing the metadata list
a_response <- mdl_survey_create(
survey_metadata_list = a_survey_metadata,
enum_collection = mdl_enum_collection$EastAfrica,
enum_survey_access_policy = mdl_enum_survey_access_policy$`Licensed use files`,
published = FALSE,
overwrite = TRUE
)
# creates all files for the package to work
devtools::document()
# load the package like it was loaded with library()
devtools::load_all()
NULL == "asd"
NULL %in% "asd"
NA %in% "asd"
identical(NULL, "asd"
)
identical("asd", "asd"
)
x <- list
x$asd <- "asd"
x <- list()
x$asd <- "asd"
identical(x$asd, "asd"
)
# creates all files for the package to work
devtools::document()
# load the package like it was loaded with library()
devtools::load_all()
# setup API key
mdl_api_set_key(api_key = Sys.getenv("API_KEY_MDL"))
mdl_api_set_url(enum_api_url = mdl_enum_api_url$production)
Sys.getenv("API_KEY_MDL")
getwd()
setwd("C:\\Users\\SANSON\\Desktop\\WBG_harvest")
getwd()
mdl_harvest_nada(
library_url = "https://microdata.worldbank.org",
survey_idno = "DDI_BFA_2021_HFPS-IDP_v01_M_WB",
base_path = NULL,
upload_files = F,
idno_prefix = "WBG",
enum_collection = mdl_enum_collection$WorldBank,
overwrite = F,
published = F
)
mdl_harvest_nada(
library_url = "https://microdata.worldbank.org",
survey_idno = "BFA_2021_HFPS-IDP_v01_M_WB",
base_path = NULL,
upload_files = F,
idno_prefix = "WBG",
enum_collection = mdl_enum_collection$WorldBank,
overwrite = T,
published = F
)
mdl_harvest_nada(
library_url = "https://microdata.worldbank.org",
survey_idno = "BFA_2021_HFPS-IDP_v01_M",
base_path = NULL,
upload_files = F,
idno_prefix = "WBG",
enum_collection = mdl_enum_collection$WorldBank,
overwrite = T,
published = F
)
mdl_harvest_nada(
library_url = "https://microdata.worldbank.org",
survey_idno = "BGD_2020_CBPS-HFT_v01_M",
base_path = NULL,
upload_files = F,
idno_prefix = "WBG",
enum_collection = mdl_enum_collection$WorldBank,
overwrite = T,
published = F
)
mdl_harvest_nada(
library_url = "https://microdata.worldbank.org",
survey_idno = "IRQ_2020_HFPS-IDP_v01_M",
base_path = NULL,
upload_files = F,
idno_prefix = "WBG",
enum_collection = mdl_enum_collection$WorldBank,
overwrite = T,
published = F
)
mdl_harvest_nada(
library_url = "https://microdata.worldbank.org",
survey_idno = "UGA_2018_RHCS_v01_M",
base_path = NULL,
upload_files = F,
idno_prefix = "WBG",
enum_collection = mdl_enum_collection$WorldBank,
overwrite = T,
published = F
)
mdl_harvest_nada(
library_url = "https://microdata.worldbank.org",
survey_idno = "SOM_2020_HFPS_v02_M",
base_path = NULL,
upload_files = F,
idno_prefix = "WBG",
enum_collection = mdl_enum_collection$WorldBank,
overwrite = T,
published = F
)
mdl_harvest_nada(
library_url = "https://microdata.worldbank.org",
survey_idno = "SOM_2016_SHFS-W1_v03_M",
base_path = NULL,
upload_files = F,
idno_prefix = "WBG",
enum_collection = mdl_enum_collection$WorldBank,
overwrite = T,
published = F
)
# creates all files for the package to work
devtools::document()
# creates all files for the package to work
devtools::document()
# load the package like it was loaded with library()
devtools::load_all()
datasets_by_collection <- mdl_datasets_by_collection()
# specify api key
mdl_api_set_key(Sys.getenv("API_KEY_MDL"))
mdl_api_set_url(mdl_enum_api_url$production)
datasets_by_collection <- mdl_datasets_by_collection()
datasets_by_collection <- datasets_by_collection$datasets
View(datasets_by_collection)
# load the package like it was loaded with library()
devtools::load_all()
datasets_by_collection <- mdl_datasets_by_collection()
datasets_by_collection <- datasets_by_collection$datasets
datasets_by_collection <- mdl_datasets_by_collection(limit = 1000)
datasets_by_collection <- datasets_by_collection$datasets
View(datasets_by_collection)
datasets_by_collection <- mdl_datasets_by_collection(limit = 5000)
datasets_by_collection <- datasets_by_collection$datasets
datasets_by_collection2 <- dplyr::filter(datasets_by_collection, linked_collection %in% c("MENA"))
View(datasets_by_collection2)
sets_by_collection2 <- dplyr::filter(datasets_by_collection, linked_collection %in% c(
datasets_by_collection2 <- dplyr::filter(datasets_by_collection, linked_collection %in% c(
"vul",
"sea",
"idp",
"nas"
))
datasets_by_collection2 <- dplyr::filter(datasets_by_collection, linked_collection %in% c(
datasets_by_collection2 <- dplyr::filter(datasets_by_collection, linked_collection %in% c(
"vul",
"sea",
"idp",
"nas"
))
View(datasets_by_collection2)
table(datasets_by_collection2$linked_collection)
table(datasets_by_collection$linked_collection)
toupper(datasets_by_collection$linked_collection)
datasets_by_collection$linked_collection <- toupper(datasets_by_collection$linked_collection)
datasets_by_collection2 <- dplyr::filter(datasets_by_collection, linked_collection %in% c(
"vul",
"sea",
"idp",
"nas"
))
datasets_by_collection2 <- dplyr::filter(datasets_by_collection, linked_collection %in% c(
"VUL",
"SEA",
"IDP",
"NAS"
))
table(datasets_by_collection2$linked_collection)
View(datasets_by_collection2)
datasets_by_collection2 <- dplyr::distinct(datasets_by_collection2)
?dplyr::distinct
datasets_by_collection2 <- dplyr::distinct(datasets_by_collection2,  .keep_all = TRUE)
table(datasets_by_collection2$linked_collection)
writexl::write_xlsx(datasets_by_collection)
?writexl::write_xlsx
writexl::write_xlsx(datasets_by_collection, "IMF.xlsx")
writexl::write_xlsx(datasets_by_collection2, "IMF.xlsx")
# creates all files for the package to work
devtools::document()
# creates all files for the package to work
devtools::document()
# set path to package
setwd("C:\\Users\\SANSON\\Dropbox\\Fede\\GitHub\\mdl\\R")
# creates all files for the package to work
devtools::document()
# load the package like it was loaded with library()
devtools::load_all()
xxx <- mdl_survey_get_variable_files("UNHCR_KEN_2015_SEA_v2.1")
# specify api key
mdl_api_set_key(Sys.getenv("API_KEY_MDL"))
mdl_api_get_key()
# work on the UAT
mdl_api_set_url(mdl_enum_api_url$production)
xxx <- mdl_survey_get_variable_files("UNHCR_KEN_2015_SEA_v2.1")
xxx
xxx <- xxx$datafiles
xxx <- mdl_survey_get_variable_files("UNHCR_LBN_2022_VASYR_v2.1")
xxx <- xxx$datafiles
paste('sdf','asdf', NA, sep = "/")
paste('sdf','asdf', NULL, sep = "/")
paste('sdf','asdf',  sep = "/")
# load the package like it was loaded with library()
devtools::load_all()
xxx <- mdl_survey_get_variable_files("UNHCR_LBN_2022_VASYR_v2.1")
xxx <- xxx$datafiles
# load the package like it was loaded with library()
devtools::load_all()
yyy <- mdl_var
yyy <- mdl_survey_get_variables("UNHCR_LBN_2022_VASYR_v2.1")
# load the package like it was loaded with library()
devtools::load_all()
yyy <- mdl_survey_get_variables("UNHCR_LBN_2022_VASYR_v2.1")
yyy <- yyy$variables
View(yyy)
View(xxx)
yyy2 <- mdl_survey_get_variables("UNHCR_LBN_2022_VASYR_v2.1", file_id_1)
yyy2 <- mdl_survey_get_variables("UNHCR_LBN_2022_VASYR_v2.1", "file_id_1")
yyy2 <- yyy$variables
yyy2 <- yyy2$variables
yyy2 <- mdl_survey_get_variables("UNHCR_LBN_2022_VASYR_v2.1", "file_id_1")
yyy2 <- yyy2$variables
View(yyy2)
yyy2 <- mdl_survey_get_variables("UNHCR_LBN_2022_VASYR_v2.1", "3495")
yyy2 <- yyy2$variables
zzz <- mdl_survey_get_variable("UNHCR_LBN_2022_VASYR_v2.1", "file_id_1_V621")
# creates all files for the package to work
devtools::document()
# load the package like it was loaded with library()
devtools::load_all()
